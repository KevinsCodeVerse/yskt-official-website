{"ast":null,"code":"import \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.array.fill.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.string.fontsize.js\";\nimport { request, urlSafeBase64Encode } from '../utils';\nfunction getImageUrl(key, domain) {\n  key = encodeURIComponent(key);\n  if (domain.slice(domain.length - 1) !== '/') {\n    domain += '/';\n  }\n  return domain + key;\n}\nexport function imageView2(op, key, domain) {\n  if (!/^\\d$/.test(String(op.mode))) {\n    throw 'mode should be number in imageView2';\n  }\n  var mode = op.mode,\n    w = op.w,\n    h = op.h,\n    q = op.q,\n    format = op.format;\n  if (!w && !h) {\n    throw 'param w and h is empty in imageView2';\n  }\n  var imageUrl = 'imageView2/' + encodeURIComponent(mode);\n  imageUrl += w ? '/w/' + encodeURIComponent(w) : '';\n  imageUrl += h ? '/h/' + encodeURIComponent(h) : '';\n  imageUrl += q ? '/q/' + encodeURIComponent(q) : '';\n  imageUrl += format ? '/format/' + encodeURIComponent(format) : '';\n  if (key && domain) {\n    imageUrl = getImageUrl(key, domain) + '?' + imageUrl;\n  }\n  return imageUrl;\n}\n// invoke the imageMogr2 api of Qiniu\nexport function imageMogr2(op, key, domain) {\n  var autoOrient = op['auto-orient'];\n  var thumbnail = op.thumbnail,\n    strip = op.strip,\n    gravity = op.gravity,\n    crop = op.crop,\n    quality = op.quality,\n    rotate = op.rotate,\n    format = op.format,\n    blur = op.blur;\n  var imageUrl = 'imageMogr2';\n  imageUrl += autoOrient ? '/auto-orient' : '';\n  imageUrl += thumbnail ? '/thumbnail/' + encodeURIComponent(thumbnail) : '';\n  imageUrl += strip ? '/strip' : '';\n  imageUrl += gravity ? '/gravity/' + encodeURIComponent(gravity) : '';\n  imageUrl += quality ? '/quality/' + encodeURIComponent(quality) : '';\n  imageUrl += crop ? '/crop/' + encodeURIComponent(crop) : '';\n  imageUrl += rotate ? '/rotate/' + encodeURIComponent(rotate) : '';\n  imageUrl += format ? '/format/' + encodeURIComponent(format) : '';\n  imageUrl += blur ? '/blur/' + encodeURIComponent(blur) : '';\n  if (key && domain) {\n    imageUrl = getImageUrl(key, domain) + '?' + imageUrl;\n  }\n  return imageUrl;\n}\n// invoke the watermark api of Qiniu\nexport function watermark(op, key, domain) {\n  var mode = op.mode;\n  if (!mode) {\n    throw \"mode can't be empty in watermark\";\n  }\n  var imageUrl = 'watermark/' + mode;\n  if (mode !== 1 && mode !== 2) {\n    throw 'mode is wrong';\n  }\n  if (mode === 1) {\n    var image = op.image;\n    if (!image) {\n      throw \"image can't be empty in watermark\";\n    }\n    imageUrl += image ? '/image/' + urlSafeBase64Encode(image) : '';\n  }\n  if (mode === 2) {\n    var text = op.text,\n      font = op.font,\n      fontsize = op.fontsize,\n      fill = op.fill;\n    if (!text) {\n      throw \"text can't be empty in watermark\";\n    }\n    imageUrl += text ? '/text/' + urlSafeBase64Encode(text) : '';\n    imageUrl += font ? '/font/' + urlSafeBase64Encode(font) : '';\n    imageUrl += fontsize ? '/fontsize/' + fontsize : '';\n    imageUrl += fill ? '/fill/' + urlSafeBase64Encode(fill) : '';\n  }\n  var dissolve = op.dissolve,\n    gravity = op.gravity,\n    dx = op.dx,\n    dy = op.dy;\n  imageUrl += dissolve ? '/dissolve/' + encodeURIComponent(dissolve) : '';\n  imageUrl += gravity ? '/gravity/' + encodeURIComponent(gravity) : '';\n  imageUrl += dx ? '/dx/' + encodeURIComponent(dx) : '';\n  imageUrl += dy ? '/dy/' + encodeURIComponent(dy) : '';\n  if (key && domain) {\n    imageUrl = getImageUrl(key, domain) + '?' + imageUrl;\n  }\n  return imageUrl;\n}\n// invoke the imageInfo api of Qiniu\nexport function imageInfo(key, domain) {\n  var url = getImageUrl(key, domain) + '?imageInfo';\n  return request(url, {\n    method: 'GET'\n  });\n}\n// invoke the exif api of Qiniu\nexport function exif(key, domain) {\n  var url = getImageUrl(key, domain) + '?exif';\n  return request(url, {\n    method: 'GET'\n  });\n}\nexport function pipeline(arr, key, domain) {\n  var isArray = Object.prototype.toString.call(arr) === '[object Array]';\n  var option;\n  var errOp = false;\n  var imageUrl = '';\n  if (isArray) {\n    for (var i = 0, len = arr.length; i < len; i++) {\n      option = arr[i];\n      if (!option.fop) {\n        throw \"fop can't be empty in pipeline\";\n      }\n      switch (option.fop) {\n        case 'watermark':\n          imageUrl += watermark(option) + '|';\n          break;\n        case 'imageView2':\n          imageUrl += imageView2(option) + '|';\n          break;\n        case 'imageMogr2':\n          imageUrl += imageMogr2(option) + '|';\n          break;\n        default:\n          errOp = true;\n          break;\n      }\n      if (errOp) {\n        throw 'fop is wrong in pipeline';\n      }\n    }\n    if (key && domain) {\n      imageUrl = getImageUrl(key, domain) + '?' + imageUrl;\n      var length_1 = imageUrl.length;\n      if (imageUrl.slice(length_1 - 1) === '|') {\n        imageUrl = imageUrl.slice(0, length_1 - 1);\n      }\n    }\n    return imageUrl;\n  }\n  throw \"pipeline's first param should be array\";\n}","map":{"version":3,"names":["request","urlSafeBase64Encode","getImageUrl","key","domain","encodeURIComponent","slice","length","imageView2","op","test","String","mode","w","h","q","format","imageUrl","imageMogr2","autoOrient","thumbnail","strip","gravity","crop","quality","rotate","blur","watermark","image","text","font","fontsize","fill","dissolve","dx","dy","imageInfo","url","method","exif","pipeline","arr","isArray","Object","prototype","toString","call","option","errOp","i","len","fop","length_1"],"sources":["../../src/image/index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
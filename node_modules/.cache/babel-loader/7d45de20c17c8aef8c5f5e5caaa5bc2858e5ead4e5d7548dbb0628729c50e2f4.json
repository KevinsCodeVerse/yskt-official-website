{"ast":null,"code":"import \"core-js/modules/es.array.join.js\";\nimport { createXHR, getAuthHeaders } from '../utils';\n/**\n * @param  {string} token 上传使用的 token\n * @param  {V3LogInfo} data 上报的统计数据\n * @param  {number} retry 重试的次数，默认值 3\n * @description v3 版本的日志上传接口，参考文档 https://github.com/qbox/product/blob/master/kodo/uplog.md#%E7%89%88%E6%9C%AC-3。\n */\nexport function reportV3(token, data, retry) {\n  if (retry === void 0) {\n    retry = 3;\n  }\n  var xhr = createXHR();\n  xhr.open('POST', 'https://uplog.qbox.me/log/3');\n  xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n  xhr.setRequestHeader('Authorization', getAuthHeaders(token).Authorization);\n  xhr.onreadystatechange = function () {\n    if (xhr.readyState === 4 && xhr.status !== 200 && retry > 0) {\n      reportV3(token, data, retry - 1);\n    }\n  };\n  // 顺序参考：https://github.com/qbox/product/blob/master/kodo/uplog.md#%E7%89%88%E6%9C%AC-3\n  var stringifyData = [data.code || '', data.reqId || '', data.host || '', data.remoteIp || '', data.port || '', data.duration || '', data.time || '', data.bytesSent || '', data.upType || '', data.size || ''].join(',');\n  xhr.send(stringifyData);\n}","map":{"version":3,"names":["createXHR","getAuthHeaders","reportV3","token","data","retry","xhr","open","setRequestHeader","Authorization","onreadystatechange","readyState","status","stringifyData","code","reqId","host","remoteIp","port","duration","time","bytesSent","upType","size","join","send"],"sources":["../../src/logger/report-v3.ts"],"sourcesContent":[null],"mappings":";AAAA,SAASA,SAAS,EAAEC,cAAc,QAAQ,UAAU;AAepD;;;;;;AAMA,OAAM,SAAUC,QAAQA,CAACC,KAAa,EAAEC,IAAe,EAAEC,KAAS;EAAT,IAAAA,KAAA;IAAAA,KAAA,IAAS;EAAA;EAChE,IAAMC,GAAG,GAAGN,SAAS,EAAE;EACvBM,GAAG,CAACC,IAAI,CAAC,MAAM,EAAE,6BAA6B,CAAC;EAC/CD,GAAG,CAACE,gBAAgB,CAAC,cAAc,EAAE,mCAAmC,CAAC;EACzEF,GAAG,CAACE,gBAAgB,CAAC,eAAe,EAAEP,cAAc,CAACE,KAAK,CAAC,CAACM,aAAa,CAAC;EAC1EH,GAAG,CAACI,kBAAkB,GAAG;IACvB,IAAIJ,GAAG,CAACK,UAAU,KAAK,CAAC,IAAIL,GAAG,CAACM,MAAM,KAAK,GAAG,IAAIP,KAAK,GAAG,CAAC,EAAE;MAC3DH,QAAQ,CAACC,KAAK,EAAEC,IAAI,EAAEC,KAAK,GAAG,CAAC,CAAC;;EAEpC,CAAC;EAED;EACA,IAAMQ,aAAa,GAAG,CACpBT,IAAI,CAACU,IAAI,IAAI,EAAE,EACfV,IAAI,CAACW,KAAK,IAAI,EAAE,EAChBX,IAAI,CAACY,IAAI,IAAI,EAAE,EACfZ,IAAI,CAACa,QAAQ,IAAI,EAAE,EACnBb,IAAI,CAACc,IAAI,IAAI,EAAE,EACfd,IAAI,CAACe,QAAQ,IAAI,EAAE,EACnBf,IAAI,CAACgB,IAAI,IAAI,EAAE,EACfhB,IAAI,CAACiB,SAAS,IAAI,EAAE,EACpBjB,IAAI,CAACkB,MAAM,IAAI,EAAE,EACjBlB,IAAI,CAACmB,IAAI,IAAI,EAAE,CAChB,CAACC,IAAI,CAAC,GAAG,CAAC;EAEXlB,GAAG,CAACmB,IAAI,CAACZ,aAAa,CAAC;AACzB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nvar Pool = /** @class */function () {\n  function Pool(runTask, limit) {\n    this.runTask = runTask;\n    this.limit = limit;\n    this.aborted = false;\n    this.queue = [];\n    this.processing = [];\n  }\n  Pool.prototype.enqueue = function (task) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n      _this.queue.push({\n        task: task,\n        resolve: resolve,\n        reject: reject\n      });\n      _this.check();\n    });\n  };\n  Pool.prototype.run = function (item) {\n    var _this = this;\n    this.queue = this.queue.filter(function (v) {\n      return v !== item;\n    });\n    this.processing.push(item);\n    this.runTask(item.task).then(function () {\n      _this.processing = _this.processing.filter(function (v) {\n        return v !== item;\n      });\n      item.resolve();\n      _this.check();\n    }, function (err) {\n      return item.reject(err);\n    });\n  };\n  Pool.prototype.check = function () {\n    var _this = this;\n    if (this.aborted) return;\n    var processingNum = this.processing.length;\n    var availableNum = this.limit - processingNum;\n    this.queue.slice(0, availableNum).forEach(function (item) {\n      _this.run(item);\n    });\n  };\n  Pool.prototype.abort = function () {\n    this.queue = [];\n    this.aborted = true;\n  };\n  return Pool;\n}();\nexport { Pool };","map":{"version":3,"names":["Pool","runTask","limit","aborted","queue","processing","prototype","enqueue","task","_this","Promise","resolve","reject","push","check","run","item","filter","v","then","err","processingNum","length","availableNum","slice","forEach","abort"],"sources":["../../src/utils/pool.ts"],"sourcesContent":[null],"mappings":";;;;;;AAQA,IAAAA,IAAA;EAKE,SAAAA,KAAoBC,OAAmB,EAAUC,KAAa;IAA1C,KAAAD,OAAO,GAAPA,OAAO;IAAsB,KAAAC,KAAK,GAALA,KAAK;IAJtD,KAAAC,OAAO,GAAG,KAAK;IACf,KAAAC,KAAK,GAA2B,EAAE;IAClC,KAAAC,UAAU,GAA2B,EAAE;EAE0B;EAEjEL,IAAA,CAAAM,SAAA,CAAAC,OAAO,GAAP,UAAQC,IAAO;IAAf,IAAAC,KAAA;IACE,OAAO,IAAIC,OAAO,CAAO,UAACC,OAAO,EAAEC,MAAM;MACvCH,KAAI,CAACL,KAAK,CAACS,IAAI,CAAC;QACdL,IAAI,EAAAA,IAAA;QACJG,OAAO,EAAAA,OAAA;QACPC,MAAM,EAAAA;OACP,CAAC;MACFH,KAAI,CAACK,KAAK,EAAE;IACd,CAAC,CAAC;EACJ,CAAC;EAEOd,IAAA,CAAAM,SAAA,CAAAS,GAAG,GAAX,UAAYC,IAAqB;IAAjC,IAAAP,KAAA;IACE,IAAI,CAACL,KAAK,GAAG,IAAI,CAACA,KAAK,CAACa,MAAM,CAAC,UAAAC,CAAC;MAAI,OAAAA,CAAC,KAAKF,IAAI;IAAV,CAAU,CAAC;IAC/C,IAAI,CAACX,UAAU,CAACQ,IAAI,CAACG,IAAI,CAAC;IAC1B,IAAI,CAACf,OAAO,CAACe,IAAI,CAACR,IAAI,CAAC,CAACW,IAAI,CAC1B;MACEV,KAAI,CAACJ,UAAU,GAAGI,KAAI,CAACJ,UAAU,CAACY,MAAM,CAAC,UAAAC,CAAC;QAAI,OAAAA,CAAC,KAAKF,IAAI;MAAV,CAAU,CAAC;MACzDA,IAAI,CAACL,OAAO,EAAE;MACdF,KAAI,CAACK,KAAK,EAAE;IACd,CAAC,EACD,UAAAM,GAAG;MAAI,OAAAJ,IAAI,CAACJ,MAAM,CAACQ,GAAG,CAAC;IAAhB,CAAgB,CACxB;EACH,CAAC;EAEOpB,IAAA,CAAAM,SAAA,CAAAQ,KAAK,GAAb;IAAA,IAAAL,KAAA;IACE,IAAI,IAAI,CAACN,OAAO,EAAE;IAClB,IAAMkB,aAAa,GAAG,IAAI,CAAChB,UAAU,CAACiB,MAAM;IAC5C,IAAMC,YAAY,GAAG,IAAI,CAACrB,KAAK,GAAGmB,aAAa;IAC/C,IAAI,CAACjB,KAAK,CAACoB,KAAK,CAAC,CAAC,EAAED,YAAY,CAAC,CAACE,OAAO,CAAC,UAAAT,IAAI;MAC5CP,KAAI,CAACM,GAAG,CAACC,IAAI,CAAC;IAChB,CAAC,CAAC;EACJ,CAAC;EAEDhB,IAAA,CAAAM,SAAA,CAAAoB,KAAK,GAAL;IACE,IAAI,CAACtB,KAAK,GAAG,EAAE;IACf,IAAI,CAACD,OAAO,GAAG,IAAI;EACrB,CAAC;EACH,OAAAH,IAAC;AAAD,CAAC,CA5CD","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import \"core-js/modules/es.function.bind.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport Resume from './resume';\nimport Direct from './direct';\nimport Logger from '../logger';\nimport { Observable, MB, normalizeUploadConfig } from '../utils';\nimport { HostPool } from './hosts';\nexport * from './base';\nexport * from './resume';\nexport function createUploadManager(options, handlers, hostPool, logger) {\n  if (options.config && options.config.forceDirect) {\n    logger.info('ues forceDirect mode.');\n    return new Direct(options, handlers, hostPool, logger);\n  }\n  if (options.file.size > 4 * MB) {\n    logger.info('file size over 4M, use Resume.');\n    return new Resume(options, handlers, hostPool, logger);\n  }\n  logger.info('file size less or equal than 4M, use Direct.');\n  return new Direct(options, handlers, hostPool, logger);\n}\n/**\n * @param file 上传文件\n * @param key 目标文件名\n * @param token 上传凭证\n * @param putExtra 上传文件的相关资源信息配置\n * @param config 上传任务的配置\n * @returns 返回用于上传任务的可观察对象\n */\nexport default function upload(file, key, token, putExtra, config) {\n  // 为每个任务创建单独的 Logger\n  var logger = new Logger(token, config === null || config === void 0 ? void 0 : config.disableStatisticsReport, config === null || config === void 0 ? void 0 : config.debugLogLevel, file.name);\n  var options = {\n    file: file,\n    key: key,\n    token: token,\n    putExtra: putExtra,\n    config: normalizeUploadConfig(config, logger)\n  };\n  // 创建 host 池\n  var hostPool = new HostPool(options.config.uphost);\n  return new Observable(function (observer) {\n    var manager = createUploadManager(options, {\n      onData: function onData(data) {\n        return observer.next(data);\n      },\n      onError: function onError(err) {\n        return observer.error(err);\n      },\n      onComplete: function onComplete(res) {\n        return observer.complete(res);\n      }\n    }, hostPool, logger);\n    manager.putFile();\n    return manager.stop.bind(manager);\n  });\n}","map":{"version":3,"names":["Resume","Direct","Logger","Observable","MB","normalizeUploadConfig","HostPool","createUploadManager","options","handlers","hostPool","logger","config","forceDirect","info","file","size","upload","key","token","putExtra","disableStatisticsReport","debugLogLevel","name","uphost","observer","manager","onData","data","next","onError","err","error","onComplete","res","complete","putFile","stop","bind"],"sources":["../../src/upload/index.ts"],"sourcesContent":[null],"mappings":";;AAAA,OAAOA,MAAM,MAAM,UAAU;AAC7B,OAAOC,MAAM,MAAM,UAAU;AAC7B,OAAOC,MAAM,MAAM,WAAW;AAE9B,SAASC,UAAU,EAAaC,EAAE,EAAEC,qBAAqB,QAAQ,UAAU;AAG3E,SAASC,QAAQ,QAAQ,SAAS;AAElC,cAAc,QAAQ;AACtB,cAAc,UAAU;AAExB,OAAM,SAAUC,mBAAmBA,CACjCC,OAAsB,EACtBC,QAAwB,EACxBC,QAAkB,EAClBC,MAAc;EAEd,IAAIH,OAAO,CAACI,MAAM,IAAIJ,OAAO,CAACI,MAAM,CAACC,WAAW,EAAE;IAChDF,MAAM,CAACG,IAAI,CAAC,uBAAuB,CAAC;IACpC,OAAO,IAAIb,MAAM,CAACO,OAAO,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,MAAM,CAAC;;EAGxD,IAAIH,OAAO,CAACO,IAAI,CAACC,IAAI,GAAG,CAAC,GAAGZ,EAAE,EAAE;IAC9BO,MAAM,CAACG,IAAI,CAAC,gCAAgC,CAAC;IAC7C,OAAO,IAAId,MAAM,CAACQ,OAAO,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,MAAM,CAAC;;EAGxDA,MAAM,CAACG,IAAI,CAAC,8CAA8C,CAAC;EAC3D,OAAO,IAAIb,MAAM,CAACO,OAAO,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,MAAM,CAAC;AACxD;AAEA;;;;;;;;AAQA,eAAc,SAAUM,MAAMA,CAC5BF,IAAU,EACVG,GAA8B,EAC9BC,KAAa,EACbC,QAAyB,EACzBR,MAAe;EAGf;EACA,IAAMD,MAAM,GAAG,IAAIT,MAAM,CAACiB,KAAK,EAAEP,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAES,uBAAuB,EAAET,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEU,aAAa,EAAEP,IAAI,CAACQ,IAAI,CAAC;EAEnG,IAAMf,OAAO,GAAkB;IAC7BO,IAAI,EAAAA,IAAA;IACJG,GAAG,EAAAA,GAAA;IACHC,KAAK,EAAAA,KAAA;IACLC,QAAQ,EAAAA,QAAA;IACRR,MAAM,EAAEP,qBAAqB,CAACO,MAAM,EAAED,MAAM;GAC7C;EAED;EACA,IAAMD,QAAQ,GAAG,IAAIJ,QAAQ,CAACE,OAAO,CAACI,MAAM,CAACY,MAAM,CAAC;EAEpD,OAAO,IAAIrB,UAAU,CAAC,UAACsB,QAItB;IACC,IAAMC,OAAO,GAAGnB,mBAAmB,CAACC,OAAO,EAAE;MAC3CmB,MAAM,EAAE,SAARA,MAAMA,CAAGC,IAAoB;QAAK,OAAAH,QAAQ,CAACI,IAAI,CAACD,IAAI,CAAC;MAAnB,CAAmB;MACrDE,OAAO,EAAE,SAATA,OAAOA,CAAGC,GAAe;QAAK,OAAAN,QAAQ,CAACO,KAAK,CAACD,GAAG,CAAC;MAAnB,CAAmB;MACjDE,UAAU,EAAE,SAAZA,UAAUA,CAAGC,GAAQ;QAAK,OAAAT,QAAQ,CAACU,QAAQ,CAACD,GAAG,CAAC;MAAtB;KAC3B,EAAExB,QAAQ,EAAEC,MAAM,CAAC;IACpBe,OAAO,CAACU,OAAO,EAAE;IACjB,OAAOV,OAAO,CAACW,IAAI,CAACC,IAAI,CAACZ,OAAO,CAAC;EACnC,CAAC,CAAC;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}